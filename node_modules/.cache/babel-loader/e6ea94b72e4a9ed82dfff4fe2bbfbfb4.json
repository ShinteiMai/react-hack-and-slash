{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport fromApi from \"../api/fromApi\";\nimport { SliceStatus } from \"../globals\";\nimport { statusHandlerReducer, wrapReduxAsyncHandler } from \"./utilities\";\nimport Levenshtein from \"fast-levenshtein\";\nimport { shuffle } from \"../utils/shuffle\";\nexport let PokemonGenerationsEnum;\n\n(function (PokemonGenerationsEnum) {\n  PokemonGenerationsEnum[\"GENERATION_1\"] = \"151\";\n  PokemonGenerationsEnum[\"GENERATION_2\"] = \"251\";\n  PokemonGenerationsEnum[\"GENERATION_3\"] = \"386\";\n  PokemonGenerationsEnum[\"GENERATION_4\"] = \"494\";\n  PokemonGenerationsEnum[\"GENERATION_5\"] = \"649\";\n  PokemonGenerationsEnum[\"GENERATION_6\"] = \"721\";\n  PokemonGenerationsEnum[\"GENERATION_7\"] = \"809\";\n})(PokemonGenerationsEnum || (PokemonGenerationsEnum = {}));\n\nconst initialState = {\n  cache: [],\n  data: [],\n  status: {\n    state: SliceStatus.IDLE\n  }\n};\nconst cachedPokemonsSlice = createSlice({\n  name: \"cachedPokemons\",\n  initialState,\n  reducers: { ...statusHandlerReducer,\n\n    getCachedPokemonsReducer(state, action) {\n      console.log(\"gets called\");\n      const {\n        cachedPokemons\n      } = action.payload;\n      const transformedCache = cachedPokemons.map(pokemon => {\n        return { ...pokemon,\n          distance: 0\n        };\n      });\n      state.cache = transformedCache;\n      state.data = shuffle(transformedCache);\n    },\n\n    searchPokemonsByNameReducer(state, action) {\n      const {\n        pokemonName\n      } = action.payload;\n      state.data = state.data.map(pokemon => {\n        return { ...pokemon,\n          distance: Levenshtein.get(pokemon.name, pokemonName)\n        };\n      }).sort((a, b) => a.distance - b.distance);\n    },\n\n    filterPokemonsByGenerationReducer(state, action) {\n      const {\n        selectedGeneration\n      } = action.payload;\n      let cache = state.cache;\n\n      if (selectedGeneration) {\n        const generations = Object.entries(PokemonGenerationsEnum);\n        let startingIndex = 0;\n        generations.forEach(([_, b], index) => {\n          if (b === selectedGeneration) {\n            startingIndex = index === 0 ? 0 : Number(generations[index - 1][1]);\n          }\n        });\n        cache = state.cache.slice(startingIndex, Number(selectedGeneration));\n      }\n\n      state.data = cache;\n    }\n\n  }\n});\nexport const cachedPokemonsReducer = cachedPokemonsSlice.reducer;\nexport const {\n  initialize,\n  error,\n  success,\n  getCachedPokemonsReducer,\n  searchPokemonsByNameReducer,\n  filterPokemonsByGenerationReducer\n} = cachedPokemonsSlice.actions;\nconst statusHandler = {\n  initialize,\n  error,\n  success\n};\nexport const cachedPokemonsSelector = state => state.cachedPokemons;\nexport const getCachedPokemons = wrapReduxAsyncHandler(statusHandler, async dispatch => {\n  const {\n    results\n  } = await fromApi.getPokemons(Number(PokemonGenerationsEnum.GENERATION_7));\n  dispatch(getCachedPokemonsReducer({\n    cachedPokemons: results\n  }));\n});","map":{"version":3,"sources":["/home/shinteimai/workspace/personal/react-pokedex/src/features/cachedPokemonsSlice.ts"],"names":["createSlice","fromApi","SliceStatus","statusHandlerReducer","wrapReduxAsyncHandler","Levenshtein","shuffle","PokemonGenerationsEnum","initialState","cache","data","status","state","IDLE","cachedPokemonsSlice","name","reducers","getCachedPokemonsReducer","action","console","log","cachedPokemons","payload","transformedCache","map","pokemon","distance","searchPokemonsByNameReducer","pokemonName","get","sort","a","b","filterPokemonsByGenerationReducer","selectedGeneration","generations","Object","entries","startingIndex","forEach","_","index","Number","slice","cachedPokemonsReducer","reducer","initialize","error","success","actions","statusHandler","cachedPokemonsSelector","getCachedPokemons","dispatch","results","getPokemons","GENERATION_7"],"mappings":"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","sourcesContent":["import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport fromApi from \"../api/fromApi\";\nimport { SliceStatus } from \"../globals\";\nimport { RootState } from \"./store\";\nimport { NamedAPIResource } from \"./types\";\nimport { statusHandlerReducer, wrapReduxAsyncHandler } from \"./utilities\";\nimport Levenshtein from \"fast-levenshtein\";\nimport { shuffle } from \"../utils/shuffle\";\n\nexport enum PokemonGenerationsEnum {\n  GENERATION_1 = \"151\",\n  GENERATION_2 = \"251\",\n  GENERATION_3 = \"386\",\n  GENERATION_4 = \"494\",\n  GENERATION_5 = \"649\",\n  GENERATION_6 = \"721\",\n  GENERATION_7 = \"809\",\n}\n\ntype SliceState = {\n  cache: (NamedAPIResource & { distance: number })[];\n  data: (NamedAPIResource & { distance: number })[];\n  status: {\n    state: SliceStatus;\n  };\n};\n\nconst initialState: SliceState = {\n  cache: [],\n  data: [],\n  status: {\n    state: SliceStatus.IDLE,\n  },\n};\n\nconst cachedPokemonsSlice = createSlice({\n  name: \"cachedPokemons\",\n  initialState,\n  reducers: {\n    ...statusHandlerReducer,\n    getCachedPokemonsReducer(\n      state,\n      action: PayloadAction<{ cachedPokemons: NamedAPIResource[] }>\n    ) {\n      console.log(\"gets called\");\n      const { cachedPokemons } = action.payload;\n      const transformedCache = cachedPokemons.map((pokemon) => {\n        return {\n          ...pokemon,\n          distance: 0,\n        };\n      });\n      state.cache = transformedCache;\n      state.data = shuffle(transformedCache);\n    },\n    searchPokemonsByNameReducer(\n      state,\n      action: PayloadAction<{\n        pokemonName: string;\n      }>\n    ) {\n      const { pokemonName } = action.payload;\n\n      state.data = state.data\n        .map((pokemon) => {\n          return {\n            ...pokemon,\n            distance: Levenshtein.get(pokemon.name, pokemonName),\n          };\n        })\n        .sort((a, b) => a.distance - b.distance);\n    },\n    filterPokemonsByGenerationReducer(\n      state,\n      action: PayloadAction<{\n        selectedGeneration: PokemonGenerationsEnum | null;\n      }>\n    ) {\n      const { selectedGeneration } = action.payload;\n      let cache: (NamedAPIResource & { distance: number })[] = state.cache;\n\n      if (selectedGeneration) {\n        const generations = Object.entries(PokemonGenerationsEnum);\n        let startingIndex: number = 0;\n        generations.forEach(([_, b], index) => {\n          if (b === selectedGeneration) {\n            startingIndex = index === 0 ? 0 : Number(generations[index - 1][1]);\n          }\n        });\n        cache = state.cache.slice(startingIndex, Number(selectedGeneration));\n      }\n\n      state.data = cache;\n    },\n  },\n});\n\nexport const cachedPokemonsReducer = cachedPokemonsSlice.reducer;\nexport const {\n  initialize,\n  error,\n  success,\n  getCachedPokemonsReducer,\n  searchPokemonsByNameReducer,\n  filterPokemonsByGenerationReducer,\n} = cachedPokemonsSlice.actions;\n\nconst statusHandler = { initialize, error, success };\n\nexport const cachedPokemonsSelector = (state: RootState) =>\n  state.cachedPokemons;\n\nexport const getCachedPokemons = wrapReduxAsyncHandler(\n  statusHandler,\n  async (dispatch) => {\n    const {\n      results,\n    }: { results: NamedAPIResource[] } = await fromApi.getPokemons(\n      Number(PokemonGenerationsEnum.GENERATION_7)\n    );\n    dispatch(getCachedPokemonsReducer({ cachedPokemons: results }));\n  }\n);\n"]},"metadata":{},"sourceType":"module"}