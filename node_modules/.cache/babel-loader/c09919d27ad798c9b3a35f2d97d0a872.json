{"ast":null,"code":"import _regeneratorRuntime from\"/home/shinteimai/workspace/personal/react-pokedex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/home/shinteimai/workspace/personal/react-pokedex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/home/shinteimai/workspace/personal/react-pokedex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/shinteimai/workspace/personal/react-pokedex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncIterator from\"/home/shinteimai/workspace/personal/react-pokedex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncIterator\";import{createSlice}from\"@reduxjs/toolkit\";import fromApi from\"../api/fromApi\";import{SliceStatus}from\"../globals\";import{camelcaseObject}from\"../utils/camelcaseObject\";import{statusHandlerReducer,wrapReduxAsyncHandler}from\"./utilities\";import{leftPad}from\"../utils/leftPad\";import{baseImageUrl}from\"../api/axios\";export var PAGINATE_SIZE=6;var initialState={data:[],status:{state:SliceStatus.IDLE}};var pokemonsSlice=createSlice({name:\"pokemons\",initialState:initialState,reducers:_objectSpread({},statusHandlerReducer,{initializePokemonsReducer:function initializePokemonsReducer(state,action){var size=action.payload.size;var nullValues=new Array(size).fill(null);if(state.data.length===0){state.data=nullValues;}else{state.data=state.data.concat(nullValues);}},getPokemonsReducer:function getPokemonsReducer(state,action){var _action$payload=action.payload,pokemon=_action$payload.pokemon,size=_action$payload.size,index=_action$payload.index;var isPokemonAlreadyExists=state.data.find(function(existingPokemon){return existingPokemon!==null&&existingPokemon.id===pokemon.id;});if(!isPokemonAlreadyExists){state.data[state.data.length-(size-index)]=pokemon;}},getSinglePokemonReducer:function getSinglePokemonReducer(state,action){var pokemon=action.payload.pokemon;var isPokemonAlreadyExists=state.data.find(function(existingPokemon){return existingPokemon!==null&&existingPokemon.id===pokemon.id;});if(!isPokemonAlreadyExists){state.data.push(pokemon);}},resetPokemonsReducer:function resetPokemonsReducer(state,action){state.data=[];}})});export var pokemonsReducer=pokemonsSlice.reducer;var _pokemonsSlice$action=pokemonsSlice.actions,initialize=_pokemonsSlice$action.initialize,error=_pokemonsSlice$action.error,success=_pokemonsSlice$action.success,initializePokemonsReducer=_pokemonsSlice$action.initializePokemonsReducer,getPokemonsReducer=_pokemonsSlice$action.getPokemonsReducer,resetPokemonsReducer=_pokemonsSlice$action.resetPokemonsReducer,getSinglePokemonReducer=_pokemonsSlice$action.getSinglePokemonReducer;export{initialize,error,success,initializePokemonsReducer,getPokemonsReducer,resetPokemonsReducer,getSinglePokemonReducer};export var pokemonsSelector=function pokemonsSelector(state){return state.pokemons;};var statusHandler={initialize:initialize,error:error,success:success};var transformSpriteToBaseImage=function transformSpriteToBaseImage(pokemonId){return baseImageUrl+leftPad(pokemonId,3)+\".png\";};export var getPokemons=wrapReduxAsyncHandler(statusHandler,/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch,_ref){var page,cachedPokemons,pokemons,size,results,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_value,_value2,_value3,index,url,pokemonId,pokemon,pokemonImageUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:page=_ref.page,cachedPokemons=_ref.cachedPokemons,pokemons=_ref.pokemons;size=PAGINATE_SIZE-pokemons.length%PAGINATE_SIZE;results=cachedPokemons.slice(page,page+size);dispatch(initializePokemonsReducer({size:size}));_iteratorNormalCompletion=true;_didIteratorError=false;_context.prev=6;_iterator=_asyncIterator(results.entries());case 8:_context.next=10;return _iterator.next();case 10:_step=_context.sent;_iteratorNormalCompletion=_step.done;_context.next=14;return _step.value;case 14:_value=_context.sent;if(_iteratorNormalCompletion){_context.next=26;break;}_value2=_value,_value3=_slicedToArray(_value2,2),index=_value3[0],url=_value3[1].url;pokemonId=Number(url.split(\"/\").slice(-2)[0]);_context.next=20;return fromApi.getPokemonById(pokemonId);case 20:pokemon=_context.sent;pokemonImageUrl=transformSpriteToBaseImage(pokemon.id);dispatch(getPokemonsReducer({pokemon:_objectSpread({},camelcaseObject(pokemon),{sprites:{frontDefault:pokemonImageUrl}}),size:size,index:index}));case 23:_iteratorNormalCompletion=true;_context.next=8;break;case 26:_context.next=32;break;case 28:_context.prev=28;_context.t0=_context[\"catch\"](6);_didIteratorError=true;_iteratorError=_context.t0;case 32:_context.prev=32;_context.prev=33;if(!(!_iteratorNormalCompletion&&_iterator.return!=null)){_context.next=37;break;}_context.next=37;return _iterator.return();case 37:_context.prev=37;if(!_didIteratorError){_context.next=40;break;}throw _iteratorError;case 40:return _context.finish(37);case 41:return _context.finish(32);case 42:case\"end\":return _context.stop();}}},_callee,null,[[6,28,32,42],[33,,37,41]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());export var getPokemonById=wrapReduxAsyncHandler(statusHandler,/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,_ref3){var pokemonId,pokemon,pokemonImageUrl,transformedPokemon;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:pokemonId=_ref3.pokemonId;_context2.next=3;return fromApi.getPokemonById(pokemonId);case 3:pokemon=_context2.sent;pokemonImageUrl=transformSpriteToBaseImage(pokemon.id);transformedPokemon=_objectSpread({},pokemon,{sprites:{frontDefault:pokemonImageUrl}});dispatch(getSinglePokemonReducer({pokemon:transformedPokemon}));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3,_x4){return _ref4.apply(this,arguments);};}());","map":{"version":3,"sources":["/home/shinteimai/workspace/personal/react-pokedex/src/features/pokemonSlice.ts"],"names":["createSlice","fromApi","SliceStatus","camelcaseObject","statusHandlerReducer","wrapReduxAsyncHandler","leftPad","baseImageUrl","PAGINATE_SIZE","initialState","data","status","state","IDLE","pokemonsSlice","name","reducers","initializePokemonsReducer","action","size","payload","nullValues","Array","fill","length","concat","getPokemonsReducer","pokemon","index","isPokemonAlreadyExists","find","existingPokemon","id","getSinglePokemonReducer","push","resetPokemonsReducer","pokemonsReducer","reducer","actions","initialize","error","success","pokemonsSelector","pokemons","statusHandler","transformSpriteToBaseImage","pokemonId","getPokemons","dispatch","page","cachedPokemons","results","slice","entries","url","Number","split","getPokemonById","pokemonImageUrl","sprites","frontDefault","transformedPokemon"],"mappings":"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","sourcesContent":["import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport fromApi from \"../api/fromApi\";\nimport { SliceStatus } from \"../globals\";\nimport { RootState } from \"./store\";\nimport { NamedAPIResource } from \"./types\";\nimport { camelcaseObject } from \"../utils/camelcaseObject\";\nimport { statusHandlerReducer, wrapReduxAsyncHandler } from \"./utilities\";\nimport { leftPad } from \"../utils/leftPad\";\nimport { baseImageUrl } from \"../api/axios\";\n\nexport const PAGINATE_SIZE = 6;\n\nexport type Pokemon = {\n  id: number;\n  name: string;\n  baseExperience: number;\n  height: number;\n  isDefault: boolean;\n  order: number;\n  weight: number;\n  abilities: {\n    isHidden: boolean;\n    slot: number;\n    ability: NamedAPIResource;\n  }[];\n  forms: NamedAPIResource[];\n  moves: {\n    move: NamedAPIResource;\n  }[];\n  sprites: {\n    frontDefault: string;\n    frontShiny: string;\n    frontFemale: string;\n    frontShinyFemale: string;\n    backDefault: string;\n    backShiny: string;\n    backFemale: string;\n    backShinyFemale: string;\n  };\n  species: NamedAPIResource[];\n  stats: {\n    baseStat: number;\n    effort: number;\n    stat: NamedAPIResource;\n  }[];\n  types: {\n    slot: number;\n    type: NamedAPIResource;\n  }[];\n};\n\ntype SliceState = {\n  data: (Pokemon | null)[];\n  status: {\n    state: SliceStatus;\n  };\n};\n\nconst initialState: SliceState = {\n  data: [],\n  status: {\n    state: SliceStatus.IDLE,\n  },\n};\n\nconst pokemonsSlice = createSlice({\n  name: \"pokemons\",\n  initialState,\n  reducers: {\n    ...statusHandlerReducer,\n    initializePokemonsReducer(state, action: PayloadAction<{ size: number }>) {\n      const { size } = action.payload;\n      const nullValues = new Array<null>(size).fill(null);\n      if (state.data.length === 0) {\n        state.data = nullValues;\n      } else {\n        state.data = state.data.concat(nullValues);\n      }\n    },\n    getPokemonsReducer(\n      state,\n      action: PayloadAction<{ pokemon: Pokemon; index: number; size: number }>\n    ) {\n      const { pokemon, size, index } = action.payload;\n\n      const isPokemonAlreadyExists = state.data.find(\n        (existingPokemon) =>\n          existingPokemon !== null && existingPokemon.id === pokemon.id\n      );\n      if (!isPokemonAlreadyExists) {\n        state.data[state.data.length - (size - index)] = pokemon;\n      }\n    },\n    getSinglePokemonReducer(\n      state,\n      action: PayloadAction<{ pokemon: Pokemon }>\n    ) {\n      const { pokemon } = action.payload;\n      const isPokemonAlreadyExists = state.data.find(\n        (existingPokemon) =>\n          existingPokemon !== null && existingPokemon.id === pokemon.id\n      );\n      if (!isPokemonAlreadyExists) {\n        state.data.push(pokemon);\n      }\n    },\n    resetPokemonsReducer(state, action) {\n      state.data = [];\n    },\n  },\n});\n\nexport const pokemonsReducer = pokemonsSlice.reducer;\nexport const {\n  initialize,\n  error,\n  success,\n  initializePokemonsReducer,\n  getPokemonsReducer,\n  resetPokemonsReducer,\n  getSinglePokemonReducer,\n} = pokemonsSlice.actions;\n\nexport const pokemonsSelector = (state: RootState) => state.pokemons;\n\nconst statusHandler = { initialize, error, success };\n\nconst transformSpriteToBaseImage = (pokemonId: number): string => {\n  return baseImageUrl + leftPad(pokemonId, 3) + \".png\";\n};\n\nexport const getPokemons = wrapReduxAsyncHandler(\n  statusHandler,\n  async (dispatch, { page, cachedPokemons, pokemons }) => {\n    const size = PAGINATE_SIZE - (pokemons.length % PAGINATE_SIZE);\n    const results = cachedPokemons.slice(page, page + size);\n    dispatch(initializePokemonsReducer({ size }));\n\n    for await (const [index, { url }] of results.entries()) {\n      const pokemonId = Number(url.split(\"/\").slice(-2)[0]);\n      const pokemon = await fromApi.getPokemonById(pokemonId);\n      const pokemonImageUrl = transformSpriteToBaseImage(pokemon.id);\n\n      dispatch(\n        getPokemonsReducer({\n          pokemon: {\n            ...camelcaseObject(pokemon),\n            sprites: {\n              frontDefault: pokemonImageUrl,\n            },\n          },\n          size,\n          index,\n        })\n      );\n    }\n  }\n);\n\nexport const getPokemonById = wrapReduxAsyncHandler(\n  statusHandler,\n  async (dispatch, { pokemonId }) => {\n    const pokemon = await fromApi.getPokemonById(pokemonId);\n    const pokemonImageUrl = transformSpriteToBaseImage(pokemon.id);\n    const transformedPokemon = {\n      ...pokemon,\n      sprites: { frontDefault: pokemonImageUrl },\n    };\n    dispatch(getSinglePokemonReducer({ pokemon: transformedPokemon }));\n  }\n);\n"]},"metadata":{},"sourceType":"module"}